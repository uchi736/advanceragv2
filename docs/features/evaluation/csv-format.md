# RAG評価用CSVデータ作成ガイド

## CSVファイルの基本形式

RAG評価システムで使用するCSVファイルは以下の形式で作成してください：

```csv
質問,想定の引用元1,想定の引用元2,想定の引用元3
```

## 必須フィールド

### 1. 質問
- **フィールド名**: `質問`
- **内容**: RAGシステムに対するテスト質問
- **形式**: 自然言語の文章
- **例**: `RAGシステムのベクトル検索について教えてください`

### 2. 想定の引用元1（必須）
- **フィールド名**: `想定の引用元1`
- **内容**: この質問に対して期待される第1の回答・引用元
- **形式**: 期待される回答内容や関連情報のテキスト
- **長さ**: 50-300文字程度推奨

### 3. 想定の引用元2（任意）
- **フィールド名**: `想定の引用元2`
- **内容**: この質問に対して期待される第2の回答・引用元
- **形式**: 想定の引用元1と同様

### 4. 想定の引用元3（任意）
- **フィールド名**: `想定の引用元3`
- **内容**: この質問に対して期待される第3の回答・引用元
- **形式**: 想定の引用元1と同様

## CSVサンプル

```csv
質問,想定の引用元1,想定の引用元2,想定の引用元3
RAGシステムのベクトル検索について教えてください,ベクトル検索とは、データや文書をベクトル空間における点として表現し、ベクトル間の距離や類似度を用いて意味的な検索を行う手法です,従来のキーワード検索とは異なり、単純な出現頻度ではなくその意味や文脈を考慮した検索が可能で、より柔軟な関連コンテンツ検索を実現できます,埋め込み（Embedding）の生成では、各テキストデータは、埋め込みモデルを用いて高次元のベクトル表現に変換されます
ハイブリッド検索の仕組みは？,ハイブリッド検索は、ベクトル検索とキーワード検索（BM25やTF-IDFなど）を組み合わせた検索手法です,ベクトル検索では意味的な類似性を捉える一方で、キーワード検索は正確なキーワードマッチングが得意です,この２つの検索手法の結果を組み合わせることで、より包括的で正確な検索結果を提供できます
リランキングの効果について説明してください,リランキング（Re-ranking）は、初期検索で取得された候補文書群を、より精密な関連度評価手法で再順位付けする技術です,初期検索では高速性を重視した比較的軽量な手法を使用し、リランキング段階では計算コストが高いがより精密な手法を使用します,リランキングにより検索結果の精度を大幅に向上させることができ、特に上位結果の品質向上に効果的です
```

## 作成時の重要なポイント

### 1. 文字エンコーディング
- **推奨**: UTF-8 with BOM
- **代替**: UTF-8（BOMなし）
- **避ける**: Shift-JIS（文字化けの原因）

### 2. 質問の作成指針

**効果的な質問**
- 具体的で明確な質問
- RAGシステムが回答できる範囲の質問
- 取り込まれた文書に関連する内容

**避けるべき質問**
- 曖昧すぎる質問
- 取り込み文書に全く関連しない質問
- 個人情報や機密情報を含む質問

### 3. 想定の引用元の作成指針

**良い想定の引用元**
- 質問に対する正確で詳細な回答
- 取り込み文書に実際に存在する（または類似する）内容
- 50-300文字程度の適切な長さ
- 専門用語や重要キーワードを含む

**避けるべき想定の引用元**
- 短すぎる（10文字未満）または長すぎる（500文字超）
- 質問と関連性の低い内容
- 一般的すぎて特徴のない内容

### 4. データ品質のチェックポイント

**必須チェック**
- [ ] すべての行に「質問」フィールドが入力されている
- [ ] 少なくとも「想定の引用元1」が入力されている
- [ ] 文字化けがない
- [ ] カンマ区切りが正しい

**推奨チェック**
- [ ] 質問が取り込み文書の内容に関連している
- [ ] 想定の引用元が具体的で有用な情報を含んでいる
- [ ] 重複する質問がない
- [ ] バランスの取れた難易度の質問が含まれている

## ファイル作成手順

### 1. Excelで作成する場合

1. 新しいExcelファイルを作成
2. A1セルに「質問」、B1セルに「想定の引用元1」...と入力
3. 2行目以降にデータを入力
4. 「ファイル」→「名前を付けて保存」
5. 「ファイルの種類」で「CSV UTF-8（コンマ区切り）」を選択
6. 保存

### 2. テキストエディタで作成する場合

1. テキストエディタ（メモ帳、VSCode等）を開く
2. ヘッダー行を入力：`質問,想定の引用元1,想定の引用元2,想定の引用元3`
3. データ行を入力（カンマで区切る）
4. UTF-8エンコーディングで保存（拡張子は.csv）

### 3. Google スプレッドシートで作成する場合

1. 新しいGoogle スプレッドシートを作成
2. ヘッダーとデータを入力
3. 「ファイル」→「ダウンロード」→「カンマ区切り値(.csv)」
4. ダウンロードされたファイルを使用

## 評価データの規模と構成

### 推奨データ量
- **最小**: 5-10件（基本テスト用）
- **標準**: 20-50件（通常の評価用）
- **包括的**: 100件以上（詳細分析用）

### データ構成の推奨バランス
- **基本的な質問**: 30-40%（システムの基本機能確認）
- **中程度の質問**: 40-50%（実用的な評価）
- **高度な質問**: 10-20%（システム限界の確認）

### カテゴリ別の質問例

**技術的質問**
- システムの仕組みや原理
- 実装手法や技術詳細
- パフォーマンスや最適化

**概念的質問**
- 基本概念の説明
- 用語の定義
- 分類や比較

**実用的質問**
- 使用方法や手順
- トラブルシューティング
- ベストプラクティス

## トラブルシューティング

### よくある問題と解決方法

**問題**: CSVが正しく読み込まれない
**解決**: 
- エンコーディングをUTF-8に変更
- カンマの前後に余計なスペースがないか確認
- ダブルクォートで文字列を囲む

**問題**: 評価結果がすべて0.0000になる
**解決**:
- 想定の引用元が取り込み文書の内容と関連しているか確認
- 信頼性閾値を下げて再評価
- 類似度計算手法を変更

**問題**: 文字化けが発生する
**解決**:
- ファイルをUTF-8 with BOMで保存し直す
- テキストエディタでエンコーディングを確認
- Excelの場合、「CSV UTF-8」形式で保存

## サンプルファイルダウンロード

評価システムには以下のサンプルファイルが含まれています：

- `evaluation_data.csv`: RAG技術概念の基本評価データ（5件）
- `evaluation_data_sample.csv`: より包括的なサンプルデータ
- `evaluation_data_advanced.csv`: 高度な技術的内容のサンプルデータ

これらのファイルを参考に、独自の評価データを作成してください。

## まとめ

効果的な評価用CSVを作成するためには：

1. **明確で具体的な質問**を作成する
2. **詳細で正確な想定の引用元**を用意する
3. **UTF-8エンコーディング**でファイルを保存する
4. **バランスの取れた難易度**の質問を含める
5. **取り込み文書との関連性**を確保する

これらの指針に従って評価データを作成することで、RAGシステムの性能を正確かつ効果的に評価できます。